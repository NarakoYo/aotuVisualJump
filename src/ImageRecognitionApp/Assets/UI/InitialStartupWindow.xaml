<Window x:Class="ImageRecognitionApp.Assets.UI.InitialStartupWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ImageRecognitionApp.Assets.UI"
        xmlns:effects="clr-namespace:System.Windows.Media.Effects;assembly=PresentationCore"
        xmlns:converters="clr-namespace:ImageRecognitionApp.Converters"
        xmlns:animation="clr-namespace:System.Windows.Media.Animation;assembly=PresentationCore"
        mc:Ignorable="d"
        Height="514" Width="750"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize"
        MouseLeftButtonDown="Window_MouseLeftButtonDown">
    
    <Window.Resources>
        <!-- 高度转换器：将窗口高度转换为指定比例的高度 -->
        <local:HeightConverter x:Key="HeightConverter"/>
        
        <!-- 矩形转换器：用于动态创建背景图片的裁切区域 -->
        <converters:RectConverter x:Key="RectConverter"/>
        
        <!-- Thickness转换器：将四个数值参数转换为Thickness对象 -->
        <converters:ThicknessConverter x:Key="ThicknessConverter"/>
        
        <!-- 进度条样式 - 灰白相间滚筒效果 -->
        <Style x:Key="CustomProgressBar" TargetType="ProgressBar">
            <Setter Property="Height" Value="8"/>
            <Setter Property="Background" Value="#3C3C3E"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ProgressBar">
                        <Grid x:Name="TemplateRoot">
                            <Border Background="{TemplateBinding Background}" CornerRadius="4" BorderThickness="0"/>
                            <Border x:Name="PART_Track" CornerRadius="4" BorderThickness="0"/>
                            <Border x:Name="PART_Indicator" HorizontalAlignment="Left" CornerRadius="4" BorderThickness="0">
                                <!-- 背景彩色渐变 -->
                                <Border.Background>
                                      <LinearGradientBrush StartPoint="0,0" EndPoint="2,0">
                                        <GradientStop Color="#FF0000" Offset="0"/>
                                        <GradientStop Color="#FF7F00" Offset="0.166"/>
                                        <GradientStop Color="#FFFF00" Offset="0.333"/>
                                        <GradientStop Color="#00FF00" Offset="0.5"/>
                                        <GradientStop Color="#0000FF" Offset="0.666"/>
                                        <GradientStop Color="#4B0082" Offset="0.833"/>
                                        <GradientStop Color="#9400D3" Offset="1"/>
                                        <LinearGradientBrush.RelativeTransform>
                                            <TranslateTransform x:Name="RainbowTransform" X="0"/>
                                        </LinearGradientBrush.RelativeTransform>
                                      </LinearGradientBrush>
                                  </Border.Background>
                                <!-- 流光效果覆盖层 -->
                                <Grid>
                                    <Border x:Name="ShineEffect" CornerRadius="4" Opacity="0.7">
                                        <Border.Background>
                                            <LinearGradientBrush StartPoint="-1,0" EndPoint="2,0">
                                                <GradientStop Color="Transparent" Offset="0"/>
                                                <GradientStop Color="White" Offset="0.5"/>
                                                <GradientStop Color="Transparent" Offset="1"/>
                                                <LinearGradientBrush.RelativeTransform>
                                                    <TranslateTransform x:Name="ShineTransform" X="0"/>
                                                </LinearGradientBrush.RelativeTransform>
                                            </LinearGradientBrush>
                                        </Border.Background>
                                    </Border>
                                </Grid>
                                <Border.Triggers>
                                    <EventTrigger RoutedEvent="Loaded">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <!-- 流光动画 -->
                                                <!-- 七彩层流动动画 - 往返流动 -->
                                                  <DoubleAnimation 
                                                    Storyboard.TargetName="RainbowTransform" 
                                                    Storyboard.TargetProperty="X" 
                                                    From="-1" To="0" 
                                                    Duration="0:0:6" 
                                                    AutoReverse="True" 
                                                    RepeatBehavior="Forever"/>
                                                  <!-- 流光层流动动画 - 往返流动 -->
                                                  <DoubleAnimation 
                                                    Storyboard.TargetName="ShineTransform" 
                                                    Storyboard.TargetProperty="X" 
                                                    From="-1" To="1" 
                                                    Duration="0:0:2" 
                                                    AutoReverse="True" 
                                                    RepeatBehavior="Forever"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Border.Triggers>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 应用标题样式 -->
        <Style x:Key="AppTitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="TextAlignment" Value="Center"/>
        </Style>
        
        <!-- 状态文本样式 -->
        <Style x:Key="StatusTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#CCCCCC"/>
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,10,0,0"/>
        </Style>
        
        <!-- 背景图片来源文本样式 -->
        <Style x:Key="BackgroundImageSourceStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#AAAAAA"/>
            <Setter Property="TextAlignment" Value="Right"/>
            <Setter Property="Margin" Value="0,8,8,0"/>
            <Setter Property="VerticalAlignment" Value="Top"/>
            <Setter Property="HorizontalAlignment" Value="Right"/>
            <!-- 添加50%透明度的黑色背景 -->
            <Setter Property="Background" Value="#80000000"/>
            <Setter Property="Padding" Value="5,2,5,2"/>
        </Style>

        <!-- 底部版权信息文本样式 -->
        <Style x:Key="CopyrightInfoStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#AAAAAA"/>
            <Setter Property="TextAlignment" Value="Left"/>
            <Setter Property="Margin" Value="4,0,20,36"/>
            <Setter Property="VerticalAlignment" Value="Bottom"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
        </Style>
    </Window.Resources>
    
    <Grid>
        <!-- 主容器 - 圆角设计，包含所有内容 -->
        <Border Background="Transparent" CornerRadius="10" Margin="0" ClipToBounds="True">
            <Grid>
                <!-- 背景图片层 - 使用专用圆角容器确保图片被正确裁剪 -->
                <Border CornerRadius="10" ClipToBounds="True" HorizontalAlignment="Center" VerticalAlignment="Stretch" Background="Transparent">
                    <Image x:Name="BackgroundImage" 
                           Width="{Binding RelativeSource={RelativeSource AncestorType={x:Type Border}}, Path=ActualWidth}" 
                           Height="{Binding RelativeSource={RelativeSource AncestorType={x:Type Border}}, Path=ActualHeight}" 
                           HorizontalAlignment="Stretch" 
                           VerticalAlignment="Stretch" 
                           Stretch="UniformToFill"/>
                    <Border.Clip>
                        <MultiBinding Converter="{StaticResource RectConverter}">
                            <Binding Source="0"/>
                            <Binding Source="0"/>
                            <Binding Path="ActualWidth" RelativeSource="{RelativeSource AncestorType={x:Type Window}}"/>
                            <Binding Path="ActualHeight" RelativeSource="{RelativeSource AncestorType={x:Type Window}}"/>
                        </MultiBinding>
                    </Border.Clip>
                </Border>
                
                <!-- 底部黑色50%半透明蒙版 -->
                <Border Width="{Binding Path=ActualWidth, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                        Height="{Binding Path=ActualHeight, RelativeSource={RelativeSource AncestorType={x:Type Window}}, Converter={StaticResource HeightConverter}, ConverterParameter=0.2}"
                        Background="#80000000" 
                        VerticalAlignment="Bottom" 
                        HorizontalAlignment="Center" 
                        Margin="0"/>
                
                <!-- 应用Logo -->
                <Image x:Name="AppLogo" Width="100" Height="100" Margin="0,40,0,0" HorizontalAlignment="Center"
                       Stretch="Uniform" Visibility="Collapsed"/>
                
                <!-- 应用标题 -->
                <TextBlock x:Name="AppTitle" Style="{StaticResource AppTitleStyle}" HorizontalAlignment="Left">
                    <TextBlock.Margin>
                        <MultiBinding Converter="{StaticResource ThicknessConverter}">
                            <Binding Source="4"/>
                            <Binding Path="ActualHeight" RelativeSource="{RelativeSource AncestorType={x:Type Window}}" Converter="{StaticResource HeightConverter}" ConverterParameter="0.8+4"/>
                            <Binding Source="0"/>
                            <Binding Source="0"/>
                        </MultiBinding>
                    </TextBlock.Margin>
                </TextBlock>
                
                <!-- 初始化状态文本 -->
                <TextBlock x:Name="StatusText" Style="{StaticResource StatusTextStyle}" Margin="4,0,20,14"
                           Text="Initializing..." VerticalAlignment="Bottom" HorizontalAlignment="Left" TextAlignment="Left"/>
                
                <!-- 进度条 -->
                <ProgressBar x:Name="InitializationProgress" Style="{StaticResource CustomProgressBar}"
                             Minimum="0" Maximum="100" Value="0" Margin="0,0,0,0" VerticalAlignment="Bottom" HorizontalAlignment="Stretch"/>
                
                <!-- 进度百分比 -->
                <TextBlock x:Name="ProgressPercentage" Style="{StaticResource StatusTextStyle}" Margin="4,0,20,26"
                             Text="0%" VerticalAlignment="Bottom" HorizontalAlignment="Left" TextAlignment="Left" Visibility="Collapsed"/>
                
                <!-- 版本信息 -->
                <TextBlock x:Name="VersionInfo" Style="{StaticResource StatusTextStyle}" Margin="4,0,20,50"
                           Text="v0.0.1-dev" VerticalAlignment="Bottom" HorizontalAlignment="Left" TextAlignment="Left" Foreground="#AAAAAA"/>
                
                <!-- 背景图片来源文本 -->
                <TextBlock x:Name="BackgroundImageSource" Style="{StaticResource BackgroundImageSourceStyle}"
                           Text="Created by ComfyUI-XL.Wai" />

                <!-- 底部版权信息 -->
                <TextBlock x:Name="CopyrightInfo" Style="{StaticResource CopyrightInfoStyle}"
                           Text="© 2025 NaraYo. All Rights Reserved" />
            </Grid>
        </Border>
    </Grid>
</Window>